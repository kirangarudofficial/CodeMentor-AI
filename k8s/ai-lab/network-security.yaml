# Default deny all traffic
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: ai-lab
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
---
# Allow Bolt to access Ollama
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: bolt-to-ollama
  namespace: ai-lab
spec:
  podSelector:
    matchLabels:
      app: ollama
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: bolt
    ports:
    - protocol: TCP
      port: 11434
---
# Allow ingress to Bolt from ALB
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-alb-to-bolt
  namespace: ai-lab
spec:
  podSelector:
    matchLabels:
      app: bolt
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector: {}
    ports:
    - protocol: TCP
      port: 8080
---
# Allow DNS queries
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: ai-lab
spec:
  podSelector: {}
  policyTypes:
  - Egress
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53
---
# Allow Prometheus scraping
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-prometheus
  namespace: ai-lab
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    ports:
    - protocol: TCP
      port: 11434
    - protocol: TCP
      port: 8080
---
# Resource Quota
apiVersion: v1
kind: ResourceQuota
metadata:
  name: ai-lab-quota
  namespace: ai-lab
spec:
  hard:
    requests.cpu: "8"
    requests.memory: "24Gi"
    limits.cpu: "16"
    limits.memory: "32Gi"
    persistentvolumeclaims: "3"
    services.loadbalancers: "0"
---
# Limit Range
apiVersion: v1
kind: LimitRange
metadata:
  name: ai-lab-limits
  namespace: ai-lab
spec:
  limits:
  - type: Container
    default:
      cpu: "500m"
      memory: "1Gi"
    defaultRequest:
      cpu: "100m"
      memory: "256Mi"
    max:
      cpu: "4"
      memory: "8Gi"
    min:
      cpu: "50m"
      memory: "128Mi"
  - type: Pod
    max:
      cpu: "8"
      memory: "16Gi"
  - type: PersistentVolumeClaim
    max:
      storage: "100Gi"
    min:
      storage: "1Gi"
